{% extends "core/base.html" %}

{% block title %}Аналитика криптовалют{% endblock %}

{% block content %}
    <h1>Аналитика криптовалют</h1>

    <div class="form">
        <label for="amount">Сумма инвестиций:</label>
        <input type="number" id="amount" name="amount" min="1" placeholder="Введите сумму" />

        <label for="risk">Уровень риска:</label>
        <input type="range" id="risk" name="risk" min="1" max="5" step="1" value="3">
        <span id="risk-value">Уровень 3</span>
    </div>

    <div class="crypto-pairs">
        <h2>Криптовалютные пары</h2>
        <ul id="crypto-pairs-list">
        </ul>
    </div>

    <button id="get-strategy-btn">Получить стратегию</button>

    <div id="strategies-list" class="strategies-list">
    </div>

    <script>
        async function fetchCryptoPairs() {
            try {
                const response = await fetch('/crypto-analytics/crypto-pairs/');
                if (!response.ok) throw new Error('Ошибка при получении криптопар');
                const data = await response.json();
                if (!data.length) throw new Error('Данные о криптопарах пусты');
                const list = document.getElementById('crypto-pairs-list');
                data.forEach(pair => {
                    const li = document.createElement('li');
                    li.innerHTML = `${pair}`;
                    list.appendChild(li);
                });
            } catch (error) {
                console.error(error.message);
            }
        }

        document.getElementById('get-strategy-btn').addEventListener('click', async function() {
            try {
                const amount = document.getElementById('amount').value;
                const riskLevel = document.getElementById('risk').value;

                const response = await fetch('/crypto-analytics/get-strategy/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ amount: amount, risk_level: riskLevel })
                });

                if (!response.ok) throw new Error('Ошибка при получении стратегии');

                const strategy = await response.json();
                const strategiesList = document.getElementById('strategies-list');
                strategiesList.innerHTML = '';
                const div = document.createElement('div');
                div.classList.add('strategy-card');
                div.innerHTML = `
                    <h3>${strategy.name}</h3>
                    <p>${strategy.description}</p>
                    <p><strong>Сумма для инвестиций:</strong> ${strategy.investment_amount}</p>
                `;
                strategiesList.appendChild(div);
            } catch (error) {
                console.error(error.message);
            }
        });

        document.getElementById('risk').addEventListener('input', function() {
            document.getElementById('risk-value').innerText = `Уровень ${this.value}`;
        });

        window.onload = fetchCryptoPairs;
    </script>
{% endblock %}
